<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="mentalHealth.css" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">
</head>
<body>
<div class="topnav">
  <a href="homePage.html">Home</a>
  <a class="active" href="clinicianInterface.html">Clinician Interface</a>
  <a href="decisionTree.html">Decision Tree</a>
</div>

<h1>Clinician Interface</h1>
<!--
<button id = "choicesButton" >What are my selections?</button>



-->
<div id = "questionBox" class = "question">
  QUESTION
</div>

<div id = "diagnosesBox" class="boxed">
Lists all the possible diagnoses and their definitions after user has filtered.

</div>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="d3.tip.js"></script>

<script src="d3-context-menu.js"></script>
<script>

//graphical settings
var diameter = 5000; //max size of circle 
var width = 700;
var height = 500;
var format = d3.format(",d");
var total = 207;
 

//creation of a bubble
var bubble = d3.pack() 
  .size([diameter, diameter])
  .padding(1.5);


//basic setting of the svg
var svg = d3.select("body")
  .append("svg")
  .attr("width", width)
  .attr("height", height) 
 
 //create tip
var tip = d3.tip()
  .attr('class', 'd3-tip')
  .html(function(d) {  
    var question = "Does the person have..." + d.question + "? Right click to answer 'Yes' or 'No'."
    d3.select("#questionBox").text(question)
    return d.category + ": " + d.definition;}) //text in the tip

svg.call(tip)

//chagne the X coordinates by region
var forceX = d3.forceX(function(d){
  return 5; 
}).strength(1)

//change the Y coordinates by region
var forceY = d3.forceY(function(d){
  return 5; 
}).strength(1)

var forceCollide = d3.forceCollide(function(d){ //DETERMINES THE SPACING OF THE CIRCLES 
       return 40;
})

//collection of forces that determine how/where our circles want to go and interact
var simulation = d3.forceSimulation() //takes every circle and applies forces to them to get them to a certain place 
  .force("x", d3.forceX(width/4).strength(0.6)) //pushes by x axis 
  .force("y", d3.forceY(height/5).strength(0.6))//pushes to the y axis
  .force("collide", forceCollide) //radius of area we want to avoid as long as it matches the radius of the circle and the parameter of force collide it wont ove"r"lap 


d3.queue()
  .defer(d3.csv, "data.csv") //THE DATA WE ARE IMPORTING 
  .await(ready)

function ready(error, datapoints){
  var filteredCodes = datapoints
  var question = "Question will be loaded here..."
  var selectedCategories = []

  var groupData = [
    {"category":"adl", "definition": "need care/support to carry out daily tasks such as grocery shopping, having a job, raising a family, etc.", "question": "Ability to provide basic, age-appropriate self-care (bathing, eating, toileting, etc.)"},
    {"category": "attachment", "definition" : "person-specific, making meaningful relationships, having problems getting close to people, opening up to people, too much or too little trust in strangers, feeling of abandonment", "question": "Ability to form meaningful relationships with others"},
    {"category":"attention", "definition": "related impulse control, information cannot be accessed readily, focus is not where it is supposed to be, consistent irresponsibility, not bringing something because you didn't know you had to, disorganized  getting distracted BY something else, having lots of things going on at once, fidgeting", "question": "Ability to apply sustained attention or effort"},
    {"category":"avoidance", "definition": "avoidance -- not yet defined", "question": "avoidance -- question not yet defined"},
    {"category":"behavior", "definition": "related impulse control, information cannot be accessed readily, focus is not where it is supposed to be, consistent irresponsibility, not bringing something because you didn't know you had to, disorganized  getting distracted BY something else, having lots of things going on at once, fidgeting", "question": "Deviation from expected adaptive behavior"},
    {"category":"cogdev", "definition": "cognitive milestones, learning, IQ, academic skills, reading, writing, speech but not communication, includes verbal, grammar, vocabulary, pronunciation", "question" : "Development of cognitive skills and abilities (intelligence, learning, language acquisition)"},
    {"category":"communication", "definition": "not person specific, generalized, conveyance of ideas, reciprocity", "question": "Ability to engage in reciprocal communication; effectively share and understand ideas/information"},
    {"category":"prereq", "definition": "of medication, of trauma, of neglect, of experience, medical history, family hisotry, requisite, requirement", "question": "prereq -- question not yet defined" },
    {"category":"concentration", "definition": "cannot focus because you are unable to, not because attention is pulled to something else, increase in goal-directed activity, too much attention to productivity/work/job", "question": "concentration -- question not yet defined" },
    {"category":"delusion", "definition": "believing in a different reality ", "question": "An idiosyncratic belief or thought process that is firmly maintained"},
    {"category":"detachment", "definition": "derealization, depersonalization, feeling like things are like a dream", "question": "A feeling of disconnection from one's body or surroundings"},
    {"category":"duration", "definition": "must have happened for a certain period of time", "question": "duration -- question not yet defined" },
    {"category":"feeling", "definition": "emotion, state of being, mood, fear, nervousness, worry, feeling of~, sexually aroused by ~ (exclude feeling of abandonment)", "question": "Disturbance of emotional state or response"},
    {"category":"hallucination", "definition": "sensory perception of something that does not exist ", "question": 'Perception of sensory stimuli in the absence of external stimulus ("seeing things","hearing voices", etc.)'},
    {"category":"iho", "definition": "damaging property, hitting, burning, etc.", "question": "Damaging property, hitting, burning, etc."},
    {"category":"impulse", "definition": "doing stuff b/c of incapability of making judgments", "question": "Inability to calculate consequences before engaging in an action or behavior"},
    {"category":"motor", "definition": "movement, too much resistance, posture, grossly disorganized/catatonic behavior, unconscious/reflex stuff, psychomotor agitation ", "question": "Expected use and movement of the body"},
    {"category":"onset", "definition": "age of onset", "question": "onset -- not yet defined" },
    {"category":"orientation", "definition": "awareness of time, place, who you are", "question": "Awareness of time, surroundings, and personal identity"},
    {"category":"rigidity", "definition": "has to be this way, insistence on sameness, inflexible adherence to routines", "question": "Insistence on sameness; inflexible adherence to routines; engaging in ritualistic behavior"},
    {"category":"risk", "definition":"potentially harming self", "question": "Engaging in behaviors despite the risk of harm to self or others"},
    {"category":"selfconcept", "definition": "grandiose sense of self (self-centered), low self-esteem, perception of self, identity of self", "question": "Awareness and beliefs about oneself, including inherent value, personal appearance, and abilities"},
    {"category":"selfharm", "definition": "intentionally harming self", "question": "Intentionally causing harm to onself, including suicidal behaviors"},
    {"category":"sensory" , "definition": "trying to seek certain senses, defensive to certain senses, sensitive to certiain senses of the body", "question": "The ability to tolerate, process, and integrate sensory stimuli"},
    {"category":"sleep", "definition": "anything related to sleep, waking up, tired, insomnia, fatigue, lethargy", "question": "Sleep and waking"},
    {"category":"sexual" , "definition": "sexual -- not yet defined", "question": "sexual -- not yet defined"},
    {"category":"somatic", "definition": "relating to the body, appetite (feeling hungry), feelings of weekness, tremors, diziness, nausea, basically anything you would go to the doctors for", "question": "The presentation of physical symptoms"},
    {"category":"substance" , "definition":"anything related to substances, drugs such as alcohol, caffeine, etc. ", "question": "Drugs, alcohol, caffeine, tobacco, etc." },
    {"category":"thought", "definition":"flashbacks, intrusive thoughts, delusions, paranoia, racing thoughts, blank, hoarding", "question": "Thought process or content"}
  ]


    var menu = [
        { title: 'Yes',
          action: function(elm, d, i) {
            console.log('Yes clicked!');
            selectCategory(d, '1')}
        },
        { title: 'No',
          action: function(elm, d, i) {
            console.log('Clicked No!');
            selectCategory(d, '0')}
        }
    ]



    var nodes = svg.selectAll('g')
      .data(groupData).enter()
      .append("g")
      
   

    var circles = nodes.append("circle")
      .attr("category", function(d){ return d.category;})
      .attr("r", function(d,i){ return radius(i); })
      .on("contextmenu", d3.contextMenu(menu))
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide )
   
   
     
      
   
  var text =nodes.append("text")
    .text(function(d){return d.category})
    .style("fill", "grey")  


    simulation.nodes(groupData) //set coordinates nodes
        .on('tick', ticked)


  d3.select('#diagnosesButton').on('click', function(){
    var description = []
      for (i = 0; i < filteredCodes.length; i++){
          var diagnosesDescription = filteredCodes[i].code + ":\n" + filteredCodes[i].description + "\n"
            +"---------------------------------------------------------------------"
            description.push(diagnosesDescription)

          
      }
    d3.select('#diagnosesBox').text(description);

  })

  d3.select("#choicesButton").on('click', function(){
     d3.select('#choicesBox').text(selectedCategories);
  })



  function selectCategory(p, response){

    d3.select("circle[category="+p.category+"]").classed("selected", "true") 
    selectedCategories.push(p.category)
    var oldfilteredCodes = filteredCodes 
    filteredCodes = filteredCodes.filter(function(obj){
          return obj[p.category] == response;
    })

     //category is completely 0 then fitler 0  
     d3.selectAll("circle").classed("notactive", function(d){
      if (changeRadius(d) == 0){
        return true;
      }
    })


     //change the radius of the data 
     d3.selectAll("circle").attr("r", function(d){
      return changeRadius(d);
     })

     var selectedCircles = d3.selectAll("circle.selected")
     var nonactiveCircles = d3.selectAll("circle.notactive")
     nonactiveCircles.on("contextmenu", false)
     selectedCircles.attr("r", 90)
     simulation.alpha(0.5).restart();
      
   }


  function changeRadius(d){
    var category = d.category; 
     var sum = 0; 
    for ( i = 0; i < filteredCodes.length; i++){
        sum += parseInt(filteredCodes[i][category]);
    }
    var frequency = sum/filteredCodes.length; 
    //console.log(category)
    //console.log(sum)
    var radius = Math.sqrt(10000*frequency/Math.PI);

    return radius; 
  }

   
   

  function radius(i){
    var category = groupData[i].category;

    var sum = 0; 
    for ( i = 0; i < filteredCodes.length; i++){
      sum += parseInt(filteredCodes[i][category]);
    }
    var frequency = sum/total; 
    //console.log(category)
    //console.log(sum)
    var radius = Math.sqrt(10000*frequency/Math.PI);
    if(radius == 0){
      return 5;
    }else{
      return radius;
    }

  }


    function ticked(){
      circles //set the coordinates of the circles 
          .attr("cx", function(d){ return d.x + 200; }) 
          .attr("cy", function(d){ return d.y + height/4; })
        
      text //set the coordinates of the text or the country name in this case
          .attr("x", function(d){ return d.x+200; }) 
          .attr("y", function(d){ return d.y +height/4; })
    }
}

</script>
<div class = "boxInAbox">
<button id = "diagnosesButton" >What are the potential diagnoses so far?</button>
</div>

<div id = "choicesBox" class="anotherQuestion">
  Lists all the user choices. 
</div>
<div class = "boxInAbox2">
<button id = "choicesButton" >What are my selections?</button>
</div>


</body>
</html>
 
